---
import { getEntry } from 'astro:content'
import readingTime from 'reading-time'

import { WORDS_PER_MINUTE } from '@common/constants'
import Tag from '@components/tag.astro'

import BaseLayout from './BaseLayout.astro'

const { frontmatter } = Astro.props

// TODO: read page from somewhere else
const page = await getEntry('post', frontmatter.slug)

if (!page) return Astro.redirect('/404/')

const { text: readingTimeText } = readingTime(page.body, { wordsPerMinute: WORDS_PER_MINUTE })
---

<BaseLayout title={frontmatter.title}>
  <section class="flex flex-col gap-2">
    <h1 class="uppercase text-2xl mb-5">{frontmatter.title}</h1>
    <img src={frontmatter.heroImageUrl} class="w-full" alt="hero image related to post" />
    <div class="h-full flex flex-wrap gap-4 my-6">
      <div class="flex flex-col">
        <span class="font-bold">Time to read</span>
        <span>~{readingTimeText}</span>
      </div>

      <div class="flex flex-col">
        <span class="font-bold">Published</span>
        <time datetime={frontmatter.date}>
          {
            new Date(frontmatter.date).toLocaleString(undefined, {
              year: 'numeric',
              month: 'long',
              day: '2-digit',
            })
          }
        </time>
      </div>

      <div class="flex flex-col">
        <span class="font-bold">Authors</span>
        <span>{frontmatter.author}</span>
      </div>
    </div>
  </section>

  <section class="post">
    <slot />
  </section>

  <ul class="flex gap-1.5 mt-4">
    {
      frontmatter.tags.map((tag: string) => (
        <li class="lowercase text-sm">
          <Tag tag={tag} />
        </li>
      ))
    }
  </ul>
</BaseLayout>
