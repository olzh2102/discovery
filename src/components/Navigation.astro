---
import { Image } from "astro:assets";

import LanguagePicker from "@components/LanguagePicker.astro";

const { lang } = Astro.params;
const currentPath = Astro.url.pathname.slice(1).replace(String(lang) + "/", "");
---

<header
  class="sticky top-0 pt-2 pb-4 z-50 flex justify-between items-end bg-header"
  transition:persist
>
  <nav class="flex gap-2 items-end">
    <a class="flex items-end gap-1 mr-2" href={`/${lang}/`}>
      <Image id="logo" src="/botqa_logo_light.gif" width="40" height="60" alt="logo" />
      <h1
        class="text-2xl font-bold uppercase absolute -top-full -left-full sm:static"
      >
        botqa
      </h1>
    </a>
    <a class={currentPath == "timeline" ? "line-through" : ""} href="timeline"
      >Timeline</a
    >
    <a
      class={currentPath == "photography" ? "line-through" : ""}
      href="photography">Photography</a
    >
  </nav>
  <div class="flex gap-2 items-center">
    <button id="theme-toggler">
      <Image id="theme-icon" src="/images/moon.svg" alt="theme icon" width="20" height="20" />
    </button>
    <LanguagePicker />
  </div>
</header>

<script>
  const element = document.documentElement
  const themeToggler = document.getElementById('theme-toggler')
  const themeIcon = document.getElementById('theme-icon') as HTMLImageElement
  const logo = document.getElementById('logo') as HTMLImageElement

  const getTheme = () => window.localStorage.getItem('theme') as 'light' | 'dark'

  window.addEventListener('DOMContentLoaded', () => {
    setTheme(getTheme())
    updateImageSrc(getTheme() === 'dark')
  })

  document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

  themeToggler?.addEventListener('click', () => {
    element.classList.toggle('dark')
    const isDark = element.classList.contains('dark')

    window.localStorage.setItem('theme', isDark ? 'dark' : 'light')

    updateImageSrc(isDark)
  })

  function setTheme(theme: 'light' | 'dark') {
    if (theme == 'dark') element.classList.add('dark')
    else element.classList.remove('dark')
  }

  function updateImageSrc(isDark: boolean) {
    themeIcon.src = isDark ? '/images/sun.svg' : '/images/moon.svg'
    logo.src = isDark ? '/botqa_logo.gif' : '/botqa_logo_light.gif'
  }
</script>
